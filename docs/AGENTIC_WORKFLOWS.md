# ğŸ”„ Agentic Workflows

> AI-powered repository automation that augments â€” never replaces â€” the human development pipeline.

**Audience:** All developers | **Prerequisites:** [Custom Agents][custom-agents] Â· [Security][security]

---

## Quick Reference

| Workflow | Trigger | Output | Cost/Run |
|----------|---------|--------|----------|
| [Daily Status Report](#daily-status-report) | `schedule: daily` | Issue with `[repo status]` prefix | ~2 requests |
| [Issue Triage](#issue-triage--labeling) | `issues: opened` | Labels (max 3) + triage comment | ~2 requests |
| [PR Code Review](#pr-code-review) | `/copilot review` comment | Review comments (max 10) + summary | ~2 requests |
| [Documentation Maintenance](#documentation-maintenance) | `schedule: weekly` | Issue with `[docs]` prefix | ~2 requests |
| [Test Coverage Gaps](#test-coverage-gap-report) | `schedule: weekly` | Issues with `[test-gap]` prefix (max 3) | ~2 requests |
| [CI Failure Diagnosis](#ci-failure-diagnosis) | CI workflow fails on `main` | Issue with `[ci-fix]` prefix | ~2 requests |

**Traditional CI** (non-agentic): [CI Pipeline](#ci-pipeline) â€” lint, build, test on every push/PR.

---

## ğŸ¯ What Are Agentic Workflows?

Agentic workflows are a new kind of GitHub Actions workflow. Instead of scripting each step in YAML, you write a **Markdown file** describing what you want. The Copilot engine reads your intent, executes within constrained permissions, and produces **safe outputs** â€” a controlled write channel that limits what the AI can actually do.

### How They Differ from Traditional Actions

| Aspect | Traditional GitHub Actions | Agentic Workflows |
|--------|--------------------------|-------------------|
| **Definition** | Step-by-step YAML scripts | Natural language Markdown |
| **Execution** | Deterministic shell commands | AI-driven reasoning + tools |
| **Write access** | Full permissions you grant | Constrained via safe-outputs |
| **Flexibility** | Rigid; must anticipate all cases | Adaptive; handles novel situations |
| **Best for** | CI/CD pipelines, deployments | Analysis, triage, review, reporting |

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event       â”‚ â”€â”€â–º â”‚  Workflow.md      â”‚ â”€â”€â–º â”‚  Copilot Engine  â”‚ â”€â”€â–º â”‚  Safe Output  â”‚
â”‚  (trigger)   â”‚     â”‚  (intent + rules) â”‚     â”‚  (reasoning)     â”‚     â”‚  (constrained)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                          â”‚
                           â–¼                          â–¼
                    .lock.yml (compiled)       Tools: github, bash, edit
```

**Key principle:** Workflows have **read-only permissions** on repository content. All writes go through **safe-outputs** â€” a controlled channel that limits output type, count, and scope.

---

## ğŸ—ï¸ Architecture

### Components

| Component | File | Role |
|-----------|------|------|
| **Workflow definition** | `.github/workflows/*.md` | Natural language intent, rules, and constraints |
| **Compiled workflow** | `.github/workflows/*.lock.yml` | Machine-readable version generated by `gh aw compile` |
| **Copilot engine** | Remote | Executes the workflow using AI reasoning |
| **Safe-outputs** | Declared in `.md` | Constrained write actions (labels, comments, issues, reviews) |

### Security Model

All agentic workflows follow the **principle of least privilege**:

- **Permissions** are read-only (`contents: read`, `issues: read`, etc.)
- **Writes** go exclusively through safe-outputs with explicit limits
- **Network** is restricted to `defaults` and `node` â€” no arbitrary internet access
- **Secrets** are managed via `gh aw secrets` â€” never hardcoded in workflow files

### Agent Import Pattern

Workflows can import existing agent definitions to reuse codebase knowledge:

```markdown
## Imports
- `.github/agents/implement.agent.md` â€” codebase conventions
```

This gives the workflow access to the same conventions, patterns, and architecture knowledge that the local agents use during development.

| Workflow | Imports |
|----------|---------|
| PR Code Review | `implement.agent.md` â€” conventions for review checklist |
| Test Coverage Gaps | `test-unit.agent.md` â€” testing patterns and conventions |
| CI Failure Diagnosis | `implement.agent.md` â€” codebase context for diagnosis |

---

## âš¡ Setup

### Prerequisites

1. **Install the CLI:**
   ```bash
   gh extension install github/gh-aw
   ```

2. **Create a GitHub PAT** with "Copilot Requests" permission (fine-grained, public repos)

3. **Add the PAT as a secret:**
   ```bash
   gh aw secrets set COPILOT_GITHUB_TOKEN --value "<your-pat>"
   ```

4. **Enable GitHub Actions** in repo Settings â†’ Actions

5. **Initialize:**
   ```bash
   gh aw init
   ```

### Common Commands

| Command | Purpose |
|---------|---------|
| `gh aw compile` | Compile `.md` workflows to `.lock.yml` |
| `gh aw run <name>` | Manually trigger a workflow |
| `gh aw status` | Check workflow health |
| `gh aw logs` | View execution history |
| `gh aw secrets set <key>` | Manage workflow secrets |

---

## ğŸ“‹ Workflow Reference

### Daily Status Report

**Purpose:** Morning snapshot of repository health â€” open issues, recent PRs, component changes, test status.

| Property | Value |
|----------|-------|
| **File** | `.github/workflows/daily-repo-status.md` |
| **Trigger** | `schedule: daily` |
| **Output** | Issue with `[repo status]` prefix |
| **Setup** | `gh aw add-wizard githubnext/agentics/daily-repo-status` |

**What it reports:**
- Open issue and PR count with trends
- Recently merged changes by area (frontend, backend, database)
- Test coverage summary
- Issue backlog health

---

### Issue Triage & Labeling

**Purpose:** Automatically classify new issues by type (bug, enhancement, documentation, question) and layer (frontend, backend, database).

| Property | Value |
|----------|-------|
| **File** | `.github/workflows/issue-triage.md` |
| **Trigger** | `issues: opened` |
| **Output** | Up to 3 labels + 1 triage comment |
| **Permissions** | `contents: read`, `issues: read` |

**Labels applied:**
- **Type:** `bug`, `enhancement`, `documentation`, `question`
- **Layer:** `frontend`, `backend`, `database`
- **Special:** `good first issue` for well-scoped, newcomer-friendly issues

**Example comment:**
```
ğŸ·ï¸ Triage Summary

Type: bug
Affected area: Backend
Summary: Task update endpoint returns 500 when priority is null

Suggested next steps:
- Check null handling in backend/src/routes/tasks.ts
- Add validation for optional priority field
```

---

### PR Code Review

**Purpose:** AI-powered second-pass code review. Runs **only when a human explicitly requests it** via a `/copilot review` comment.

| Property | Value |
|----------|-------|
| **File** | `.github/workflows/pr-review.md` |
| **Trigger** | `/copilot review` comment on PR |
| **Output** | Up to 10 inline comments + 1 summary review |
| **Permissions** | `contents: read`, `pull-requests: read` |
| **Imports** | `implement.agent.md` |

**Why comment-triggered (not automatic):**
This workflow deliberately does not run on `pull_request: opened`. The human-first review process ensures juniors complete their `@Code-Review-Trainer` comprehension check and a human reviews before AI provides a safety net. See [Training Integration](#-training-integration) for the full rationale.

**What it checks:**
- Backend: ESM `.js` extensions, Prisma relation includes, field whitelisting
- Frontend: `<script setup lang="ts">`, CSS variables, `v-if`/`v-for` separation
- Security: AI-ism patterns (CORS wildcards, mass assignment, missing `await`, empty catches)
- Testing: corresponding `.spec.ts` files, AAA pattern, `data-testid` selectors

---

### Documentation Maintenance

**Purpose:** Weekly drift detection between code and documentation.

| Property | Value |
|----------|-------|
| **File** | `.github/workflows/docs-maintenance.md` |
| **Trigger** | `schedule: weekly` (Monday 09:00 UTC) |
| **Output** | Issue with `[docs]` prefix (closes older `[docs]` issues) |
| **Permissions** | `contents: read`, `issues: read`, `pull-requests: read` |

**What it checks:**
- README accuracy vs. actual `package.json` scripts
- API endpoint table vs. actual route files
- Prisma schema vs. Data Model documentation
- Component inventory vs. actual Vue files
- Agent and instruction file references vs. actual files

---

### Test Coverage Gap Report

**Purpose:** Weekly identification of source files without test coverage. Creates **issues with guidance**, not auto-generated tests â€” juniors write the tests themselves.

| Property | Value |
|----------|-------|
| **File** | `.github/workflows/test-gaps.md` |
| **Trigger** | `schedule: weekly` (Monday 10:00 UTC) |
| **Output** | Up to 3 issues with `[test-gap]` prefix, labeled `good first issue` |
| **Permissions** | `contents: read`, `issues: read` |
| **Imports** | `test-unit.agent.md` |

**Why issues, not PRs:**
Auto-generated tests bypass the learning process. When juniors write tests themselves (using `@Test-Unit` for guidance), they build deep understanding of both the code under test and the testing patterns. See [Training Integration](#-training-integration).

**Each issue includes:**
- File path and priority (High/Medium/Low)
- Summary of what the file does
- Suggested `describe` blocks (structure, not implementation)
- Reference to similar existing tests as templates
- Pointer to `@Test-Unit` agent for assistance

---

### CI Pipeline

**Purpose:** Traditional CI â€” runs lint, build, and tests on every push and PR.

| Property | Value |
|----------|-------|
| **File** | `.github/workflows/ci.yml` |
| **Trigger** | `push: main` + `pull_request` |
| **Type** | Standard YAML (not agentic) |

**Jobs:**

| Job | What it does | Runs |
|-----|-------------|------|
| `lint` | ESLint | `frontend/` |
| `build` | TypeScript compilation | `frontend/` + `backend/` (matrix) |
| `test-backend` | Vitest | `backend/` |
| `test-frontend` | Vitest | `frontend/` |

All jobs use `fail-fast: false` for full test visibility, Node.js 22, `actions/cache` for `node_modules`, and `actions/checkout@v4` with `fetch-depth: 1`.

---

### CI Failure Diagnosis

**Purpose:** When CI fails on `main`, automatically diagnoses the root cause and creates an issue with analysis and a proposed fix.

| Property | Value |
|----------|-------|
| **File** | `.github/workflows/ci-doctor.md` |
| **Trigger** | `workflow_run: CI: completed` (failure only, `main` branch) |
| **Output** | Issue with `[ci-fix]` prefix (closes older `[ci-fix]` issues) |
| **Permissions** | `contents: read`, `actions: read`, `issues: read` |
| **Imports** | `implement.agent.md` |

**Issue includes:**
- Link to the failed workflow run
- Root cause analysis from log inspection
- Affected files table
- Proposed fix with code snippets
- Prevention recommendations

---

## ğŸ“ Training Integration

Agentic workflows are designed to **augment** the [AI-Native Training][ai-native-training] pipeline, not bypass it. Three workflows have explicit training-aware behaviors:

### How Workflows Fit the Junior Development Flow

```
Issue opened
  â”‚
  â”œâ”€â”€â–º Auto-triaged with labels + comment (Issue Triage)
  â”‚
  â–¼
Junior writes spec via @Spec-First
  â”‚
  â–¼
Junior implements via @Implement
  â”‚
  â–¼
Junior passes @Code-Review-Trainer AutoMCQ (3/3 correct)
  â”‚
  â–¼
Junior opens PR â†’ human reviews
  â”‚
  â”œâ”€â”€â–º Human comments '/copilot review' (PR Code Review)
  â”‚
  â–¼
CI runs on PR
  â”‚
  â”œâ”€â”€â–º If failure on main: CI Doctor creates diagnostic issue
  â”‚
  â–¼
Weekly: test gap issues appear
  â”‚
  â””â”€â”€â–º Junior picks up [test-gap] issue â†’ writes tests via @Test-Unit
```

### Training-Aware Design Decisions

| Workflow | Design Choice | Training Rationale |
|----------|--------------|-------------------|
| **PR Code Review** | Comment-triggered, not automatic | Juniors complete AutoMCQ + human review first. AI review is a safety net, not a substitute for comprehension. |
| **Test Coverage Gaps** | Creates issues, not PRs with code | Juniors write tests themselves via `@Test-Unit`. Writing tests builds understanding of both the code and testing patterns. |
| **CI Doctor** | Full diagnosis for all | Operational speed prioritized here. Training friction is applied at earlier stages (spec, implementation, AutoMCQ). |
| **Issue Triage** | Labels `good first issue` | Helps juniors find appropriately scoped work. Combined with `[test-gap]` issues, provides a steady pipeline of learning tasks. |

### What to Watch For

> **Warning signal:** If a junior is consistently relying on CI Doctor issues to fix their code instead of forming hypotheses first, redirect them to `@Socratic-Mentor` and the "Hypothesis Before Fix" protocol in the [Plan-Act-Verify][ai-native-training] workflow.

---

## ğŸ›¡ï¸ Security Model

### Permissions Audit

| Workflow | Permissions | Safe-Outputs |
|----------|------------|--------------|
| Daily Status Report | `contents: read`, `issues: read` | `create-issue` (max: 1) |
| Issue Triage | `contents: read`, `issues: read` | `add-labels` (max: 3), `add-comment` (max: 1) |
| PR Code Review | `contents: read`, `pull-requests: read` | `create-pull-request-review-comment` (max: 10), `submit-pull-request-review` (max: 1) |
| Docs Maintenance | `contents: read`, `issues: read`, `pull-requests: read` | `create-issue` (max: 1) |
| Test Coverage Gaps | `contents: read`, `issues: read` | `create-issue` (max: 3) |
| CI Doctor | `contents: read`, `actions: read`, `issues: read` | `create-issue` (max: 1) |

**Key security properties:**
- All agentic workflows use **read-only** repository permissions
- No workflow can push code, merge PRs, or modify branch protections
- Network access is restricted to `defaults` and `node` â€” no arbitrary HTTP requests
- The single `COPILOT_GITHUB_TOKEN` secret is managed via `gh aw secrets`
- PR review includes the [AI-ism Awareness checklist][junior-workflow] from the junior training instructions

---

## ğŸ“Š Observability & Cost

### Monitoring

| Command | What it shows |
|---------|--------------|
| `gh aw status` | Health of all agentic workflows |
| `gh aw logs` | Execution history with timestamps |
| `gh aw run <name>` | Manual trigger for testing |

### Cost Estimate

Each agentic workflow run consumes approximately **2 premium requests**.

| Schedule | Workflows | Requests/Week |
|----------|-----------|---------------|
| Daily | Status Report | ~14 |
| Weekly | Docs Maintenance + Test Gaps | ~4 |
| On-demand | Issue Triage, PR Review, CI Doctor | Variable |
| **Total estimate** | | **~18 + variable** |

### Tuning Cost

To reduce costs, change scheduled workflow frequency:

```yaml
# Weekly (default)
on:
  schedule:
    - cron: '0 9 * * 1'

# Monthly (lower cost)
on:
  schedule:
    - cron: '0 9 1 * *'

# Manual only (zero recurring cost)
on:
  workflow_dispatch: {}
```

---

## ğŸ› ï¸ Troubleshooting

| Problem | Cause | Solution |
|---------|-------|----------|
| Workflow not triggering | `.lock.yml` not compiled | Run `gh aw compile` and push |
| Event fires but no output | Safe-output limit reached | Check `gh aw logs` for limit errors |
| `/copilot review` not working | Commenter lacks write permission | Check `author_association` in logs |
| Compilation error | Invalid YAML in config block | Validate YAML syntax in the `Configuration` section |
| Stale `[docs]`/`[test-gap]` issues | `close-older-issues` not working | Check issue title prefix matches exactly |
| CI Doctor not firing | Workflow name mismatch | Ensure `ci.yml` has `name: CI` matching the trigger |

---

## ğŸ”— Related

- [AI Development Guide][ai-guide] â€” Feature index and high-level overview
- [Custom Agents][custom-agents] â€” Agent definitions referenced by workflows
- [AI-Native Training][ai-native-training] â€” Junior training pipeline and Plan-Act-Verify protocol
- [Security Guide][security] â€” Security patterns, AI-ism awareness, MCP risk scoring

<!-- Documentation Files -->
[ai-guide]: ./AI_DEVELOPMENT_GUIDE.md
[custom-agents]: ./CUSTOM_AGENTS.md
[custom-instructions]: ./CUSTOM_INSTRUCTIONS.md
[ai-native-training]: ./AI_NATIVE_TRAINING.md
[security]: ./SECURITY.md
[junior-workflow]: ../.github/instructions/junior-ai-workflow.instructions.md
